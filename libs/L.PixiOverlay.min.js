!function(e){if("function"==typeof define&&define.amd)define(["leaflet","pixi.js"],e);else if("undefined"!=typeof module)module.exports=e(require("leaflet"),require("pixi.js"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");if(void 0===window.PIXI)throw new Error("Pixi.js must be loaded first");e(window.L,window.PIXI)}}(function(u,r){var e=u.Point.prototype._round,t=function(){return this};function i(e,t,i){t?e.destroy():i||(e.autoPreventDefault=!1)}var n={options:{padding:.1,forceCanvas:!1,doubleBuffering:!1,resolution:u.Browser.retina?2:1,projectionZoom:function(e){return(e.getMaxZoom()+e.getMinZoom())/2},destroyInteractionManager:!1,autoPreventDefault:!0,preserveDrawingBuffer:!1,clearBeforeRender:!0},initialize:function(e,t,i){u.setOptions(this,i),u.stamp(this),this._drawCallback=e,this._pixiContainer=t,this._rendererOptions={transparent:!0,resolution:this.options.resolution,antialias:!0,forceCanvas:this.options.forceCanvas,preserveDrawingBuffer:this.options.preserveDrawingBuffer,clearBeforeRender:this.options.clearBeforeRender},this._doubleBuffering=r.utils.isWebGLSupported()&&!this.options.forceCanvas&&this.options.doubleBuffering},_setMap:function(){},_setContainerStyle:function(){},_addContainer:function(){this.getPane().appendChild(this._container)},_setEvents:function(){},onAdd:function(e){if(this._setMap(e),!this._container){var t=this._container=u.DomUtil.create("div","leaflet-pixi-overlay");t.style.position="absolute",this._renderer=r.autoDetectRenderer(this._rendererOptions),i(this._renderer.plugins.interaction,this.options.destroyInteractionManager,this.options.autoPreventDefault),t.appendChild(this._renderer.view),this._zoomAnimated&&(u.DomUtil.addClass(t,"leaflet-zoom-animated"),this._setContainerStyle()),this._doubleBuffering&&(this._auxRenderer=r.autoDetectRenderer(this._rendererOptions),i(this._auxRenderer.plugins.interaction,this.options.destroyInteractionManager,this.options.autoPreventDefault),t.appendChild(this._auxRenderer.view),this._renderer.view.style.position="absolute",this._auxRenderer.view.style.position="absolute")}this._addContainer(),this._setEvents();var n=this._map;this._initialZoom=this.options.projectionZoom(n),this._wgsOrigin=u.latLng([0,0]),this._wgsInitialShift=n.project(this._wgsOrigin,this._initialZoom),this._mapInitialZoom=n.getZoom(),this._scale=n.getZoomScale(this._mapInitialZoom,this._initialZoom);var o=this;this.utils={latLngToLayerPoint:function(e,t){return t=void 0===t?o._initialZoom:t,n.project(u.latLng(e),t)},layerPointToLatLng:function(e,t){t=void 0===t?o._initialZoom:t;var i=u.point(e);return n.unproject(i,t)},getScale:function(e){return void 0===e?n.getZoomScale(n.getZoom(),o._initialZoom):n.getZoomScale(e,o._initialZoom)},getRenderer:function(){return o._renderer},getContainer:function(){return o._pixiContainer},getMap:function(){return o._map}},this._update({type:"add"})},onRemove:function(){u.DomUtil.remove(this._container)},getEvents:function(){var e={zoom:this._onZoom,moveend:this._update,zoomend:this._zoomChange};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(e){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var i=this._map.getZoomScale(t,this._zoom),n=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,t),r=n.multiplyBy(-i).add(o).subtract(this._map._getNewPixelOrigin(e,t));u.Browser.any3d?u.DomUtil.setTransform(this._container,r,i):u.DomUtil.setPosition(this._container,r)},_redraw:function(e,t){this._disableLeafletRounding();var i=this._map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale))._subtract(e);this._pixiContainer.scale.set(this._scale),this._pixiContainer.position.set(i.x,i.y),this._drawCallback(this.utils,t),this._enableLeafletRounding()},_update:function(e){if(!this._map._animatingZoom||!this._bounds){var t=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();if(this._bounds=new u.Bounds(n,n.add(i.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._doubleBuffering){var o=this._renderer;this._renderer=this._auxRenderer,this._auxRenderer=o}var r=this._renderer.view,s=this._bounds,a=this._container,h=s.getSize();if(!this._renderer.size||this._renderer.size.x!==h.x||this._renderer.size.y!==h.y){if(this._renderer.gl&&(this._renderer.resolution=this.options.resolution,this._renderer.rootRenderTarget&&(this._renderer.rootRenderTarget.resolution=this.options.resolution)),this._renderer.resize(h.x,h.y),r.style.width=h.x+"px",r.style.height=h.y+"px",this._renderer.gl){var d=this._renderer.gl;if(d.drawingBufferWidth!==this._renderer.width){var l=this.options.resolution*d.drawingBufferWidth/this._renderer.width;this._renderer.resolution=l,this._renderer.rootRenderTarget&&(this._renderer.rootRenderTarget.resolution=l),this._renderer.resize(h.x,h.y)}}this._renderer.size=h}if(this._doubleBuffering){var _=this;requestAnimationFrame(function(){_._redraw(s.min,e),_._renderer.gl.finish(),r.style.visibility="visible",_._auxRenderer.view.style.visibility="hidden",u.DomUtil.setPosition(a,s.min)})}else this._redraw(s.min,e),u.DomUtil.setPosition(a,s.min)}},_disableLeafletRounding:function(){u.Point.prototype._round=t},_enableLeafletRounding:function(){u.Point.prototype._round=e},_zoomChange:function(){this._scale=this._map.getZoomScale(this._map.getZoom(),this._initialZoom)},redraw:function(e){return this._map&&(this._disableLeafletRounding(),this._drawCallback(this.utils,e),this._enableLeafletRounding()),this}};"1"<=u.version?u.PixiOverlay=u.Layer.extend(n):(u.Map.prototype.getZoomScale=function(e,t){var i=this.options.crs;return t=void 0===t?this._zoom:t,i.scale(e)/i.scale(t)},u.DomUtil.setTransform=function(e,t,i){var n=t||new u.Point(0,0);e.style[u.DomUtil.TRANSFORM]=(u.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},n.includes=u.Mixin.Events,n.addTo=function(e){return e.addLayer(this),this},n._setMap=function(e){this._map=e,this._zoomAnimated=e._zoomAnimated},n._setContainerStyle=function(){var t=this;["-webkit-transform-origin","-ms-transform-origin","transform-origin"].forEach(function(e){t._container.style[e]="0 0"})},n._addContainer=function(){this._map.getPanes()[this.options.pane||"overlayPane"].appendChild(this._container)},n._setEvents=function(){var e=this.getEvents();for(var t in e)this._map.on(t,e[t],this)},n.onRemove=function(){this._map.getPanes()[this.options.pane||"overlayPane"].removeChild(this._container);var e=this.getEvents();for(var t in e)this._map.off(t,e[t],this)},u.PixiOverlay=u.Class.extend(n)),u.pixiOverlay=function(e,t,i){return u.Browser.canvas?new u.PixiOverlay(e,t,i):null}});